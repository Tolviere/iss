<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="main-style.css">
</head>
<body>
    <div class="top-header">
        <h1>THE ISS</h1>
        <ul>
            <li><a href="index.html">home</a></li>
            <li><a href="transit.html">transit</a></li>
            <li><a href="logs.html">logs</a></li>
        </ul>
    </div>
    <div class="log-container"></div>
</body>

<script>
    const responseAPI = async () => {
        let names = await getData('http://localhost:3000/DATA-names')
        let logs = await getData('http://localhost:3000/DATA-full-logs')
        let roomNums = await getData('http://localhost:3000/DATA-room-nums')
        logs.reverse()

        const logContainer = document.querySelector('.log-container')

        for (let i = 0; i < logs.length; i++) {
            let log = document.createElement('div')
            log.classList.add('log')

            let student_name = names.find(nameDict => nameDict.student_id === logs[i].student_id);

            if (!student_name) student_name = 'NAME'
            else student_name = student_name.name

            let room_num = roomNums.find(roomDict => roomDict.ip === logs[i].ip);

            if (!room_num) room_num = 'ROOM NUMBER'
            else room_num = room_num.room_number

            log.textContent = `${student_name} (${logs[i].student_id}) scanned at Room ${room_num} (${logs[i].ip}) at ${logs[i].time}`
            logContainer.appendChild(log)
        }
    }

    async function getData(src) {
        const res = await fetch(src)
        const data = await res.json()
        return data;
    }

    responseAPI();
</script>
</html>